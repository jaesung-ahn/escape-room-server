# Wiiee 프로젝트 CTO 관점 종합 개선 계획

## Executive Summary

**프로젝트**: Wiiee 방탈출 검색/소셜 플랫폼 (Spring Boot 3.0, 멀티모듈)
**기술 성숙도**: Level 2.5/5 (개발 단계 → 상용화 준비 단계)
**전체 평가**: 5.75/10 (중간 수준)

**팀 상황**:
- 배포 상태: 개발 단계 (배포 전) - 안정적인 리팩토링 가능
- 팀 규모: 3-5명 중규모 - 병렬 작업 가능
- 우선순위: 보안 + 성능 + 아키텍처 + DevOps 전방위 개선
- 타임라인: 3-6개월 중장기 - 체계적 단계별 접근

---

## 주요 발견사항

### 영역별 평가

| 영역 | 점수 | 평가 | 긴급도 |
|------|------|------|--------|
| 아키텍처 | 5.75/10 | God Service 문제, 코드 중복 | HIGH |
| 보안 | 2/5 | JWT Secret 하드코딩, RBAC 미흡 | CRITICAL |
| 성능 | 4/10 | N+1 쿼리 문제, 인덱스 부재 | HIGH |
| 테스트 | 6/10 | Acceptance 테스트 86%, 단위 테스트 부재 | MEDIUM |
| DevOps | 1/10 | CI/CD 미구현, 배포 자동화 없음 | MEDIUM |
| 문서화 | 7/10 | 양호한 프로젝트 문서 | LOW |

### 즉시 조치 필요 항목

1. **보안**: JWT Secret Key 환경변수화
2. **보안**: 권한 제어(RBAC) 구현
3. **성능**: N+1 쿼리 제거 (RecommendationService 등)

---

## 개선 계획 로드맵

### Phase 1: 긴급 보안 및 성능 (1-2주)

#### 보안 Critical 이슈
- JWT Secret Key 환경변수화
  - 위치: `api/infrastructure/jwt/JwtTokenProvider.java:27`
  - 현재: 하드코딩된 secret key
  - 개선: application.yml 환경변수 주입
- RBAC 구현
  - User 엔티티 Role 필드 추가
  - SecurityUser getAuthorities() 구현
  - @PreAuthorize 활성화
- 리소스 접근 권한 검증
  - 모든 PUT/DELETE 엔드포인트 권한 검증 강화

#### 성능 Critical 이슈
- N+1 쿼리 제거
  - RecommendationService.getRecommendations(): 11-101번 쿼리 → Fetch Join
  - ContentService.getContentSimpleModelsByContents(): N번 이미지 조회 → 배치 로딩
  - GatheringService.getWaitingMember(): 신청자별 이미지 쿼리 → 배치 로딩
  - CommentService: 대댓글 N+1 → @Fetch(FetchMode.SUBSELECT)

**예상 효과**:
- 콘텐츠 30개 조회: 31쿼리 → 3쿼리 (90% 감소)
- 동행모집 상세: 10쿼리 → 4쿼리 (60% 감소)
- 댓글 목록: 50쿼리 → 6쿼리 (88% 감소)

---

### Phase 2: 아키텍처 리팩토링 (3-4주)

#### God Service 분해
- **GatheringService 분리** (528줄 → 4개 서비스)
  - GatheringService (핵심만 150줄)
  - GatheringMemberService (150줄)
  - GatheringRequestService (100줄)
  - GatheringNotificationService (100줄, 비동기)
- **UserService 분리** (226줄 → 3개 서비스)
  - AuthService (인증/회원가입)
  - UserProfileService (프로필 관리)
  - UserRecommendationFacadeService (추천 조회)

#### 예외 처리 통일
- RuntimeException 제거 (9개 발생)
  - UserService: 4개
  - MemberService: 1개
  - ReviewService: 2개
  - 기타: 2개
- 계층화된 ApiException 구조 도입
  - ResourceNotFoundException (404)
  - UnauthorizedException (401)
  - ForbiddenException (403)
  - ValidationException (400)
  - ConflictException (409)
  - InternalServerException (500)
- 에러 코드 중앙화 (GatheringErrorCode 패턴 확대)

#### DTO 변환 로직 통일
- 68개 Model 클래스의 `from*()` 정적 메서드 통일
- 옵션 1: ModelMapper 중앙 설정 강화
- 옵션 2: MapStruct 도입 (컴파일 타임 매핑, 성능 우수)

---

### Phase 3: 성능 최적화 및 인프라 (4-6주)

#### 데이터베이스 최적화
- 필수 인덱스 생성
  - users.email
  - content(company_id, is_operated)
  - gathering(user_id, deleted)
  - review(content_id, is_approval)
  - comment(gathering_id, parent_id)
  - gathering_request(gathering_id, request_status)
- QueryDSL Fetch Join 추가
  - ContentCustomRepositoryImpl
  - GatheringCustomRepositoryImpl
- Connection Pool 튜닝
  - maximum-pool-size: 20
  - minimum-idle: 5
  - 타임아웃 설정

#### 캐싱 전략
- Redis 캐시 구현
  - WBTI 데이터 (1시간 TTL)
  - 추천 데이터 (15분 TTL)
  - 컨텐츠 목록 (5분 TTL)
  - FAQ (1일 TTL)

#### 보안 강화
- 보안 헤더 설정 (X-Frame-Options, XSS Protection, CSP)
- CORS 상세 설정 (환경변수화)
- Rate Limiting 구현
- 민감 정보 로깅 마스킹

---

### Phase 4: DevOps 및 품질 (6-8주)

#### CI/CD 파이프라인
- GitHub Actions 워크플로우 구축
  - test, build, deploy 단계
  - 커버리지 리포트 (Codecov)
  - Docker 이미지 빌드/푸시

#### 컨테이너화
- Dockerfile 작성 (api, admin, push)
- docker-compose.yml 구성
  - API 서버
  - PostgreSQL
  - Redis

#### 테스트 커버리지
- 단위 테스트 추가 (현재 0개 → 목표 50개+)
  - 서비스 레이어 단위 테스트
  - 각 도메인 서비스별 테스트
- JaCoCo 커버리지 목표: 70%

#### 모니터링 및 로깅
- Actuator + Prometheus + Grafana
- 구조화된 로깅 (Logback JSON)
- 메트릭 수집 및 대시보드

---

## 개선 효과 예측

### 성능 개선

| 시나리오 | 개선 전 | 개선 후 | 개선율 |
|---------|--------|--------|--------|
| 콘텐츠 30개 + 이미지 조회 | 800ms, 31쿼리 | 150ms, 3쿼리 | 82% 감소 |
| 동행모집 상세 + 신청자 5명 | 600ms, 10쿼리 | 100ms, 4쿼리 | 83% 감소 |
| 댓글 10개 + 대댓글 30개 | 2000ms, 50쿼리 | 300ms, 6쿼리 | 85% 감소 |
| 추천 데이터 (캐시 후) | 1500ms, 11쿼리 | 50ms, 메모리 | 97% 감소 |

### 코드 품질 개선

| 지표 | 현재 | 목표 | 개선 |
|-----|------|------|------|
| 아키텍처 점수 | 5.75/10 | 7.5/10 | +30% |
| 보안 성숙도 | 2/5 | 4/5 | +100% |
| 서비스 평균 라인 수 | 200+ | 120 | -40% |
| RuntimeException 사용 | 9개 | 0개 | -100% |
| 테스트 커버리지 | 10개 | 60개 | +500% |
| 코드 커버리지 | 약 40% | 70%+ | +75% |

### 비용 절감 예측

- 인프라 비용: DB 쿼리 감소로 RDS 사용량 30% 감소
- 개발 효율: 명확한 아키텍처로 신규 기능 개발 시간 20% 단축
- 운영 비용: 모니터링 도입으로 장애 대응 시간 50% 감소

---

## 주요 수정 영역

### Critical 수정 대상

**보안**:
- `api/infrastructure/jwt/JwtTokenProvider.java`
- `api/application/security/SecurityConfig.java`
- `api/application/security/SecurityUser.java`
- `common/domain/user/User.java`

**성능**:
- `api/domain/recommendation/RecommendationService.java`
- `api/domain/content/ContentService.java`
- `api/domain/gathering/GatheringService.java`
- `api/domain/gathering/comment/CommentService.java`

**아키텍처**:
- `api/domain/gathering/GatheringService.java` (분해 예정)
- `api/domain/user/UserService.java` (분해 예정)
- `api/application/exception/` (예외 계층화)

---

## 팀 협업 가이드

### 개선 작업 진행 방식

1. **우선순위별 스프린트 구성**
   - Sprint 1 (1주): Critical 보안 이슈
   - Sprint 2 (2주): 성능 최적화
   - Sprint 3 (2주): 아키텍처 리팩토링
   - Sprint 4 (2주): DevOps 구축

2. **코드 리뷰 필수**
   - 모든 PR은 최소 1명 이상 리뷰
   - Critical 변경사항은 CTO 리뷰 필수

3. **문서화 동시 진행**
   - 아키텍처 결정 사항 기록 (ADR)
   - API 문서 자동 생성 (Swagger)
   - 배포 가이드 작성

4. **테스트 우선**
   - 새 기능 개발 시 테스트 먼저 작성
   - 리팩토링 전 기존 기능 테스트 작성

---

## 성공 지표 (KPI)

| 지표 | 현재 | 1개월 후 | 3개월 후 |
|-----|------|---------|---------|
| 평균 API 응답 시간 | 800ms | 300ms | 150ms |
| 보안 취약점 | 3개 Critical | 0개 | 0개 |
| 테스트 커버리지 | 40% | 55% | 70%+ |
| 배포 소요 시간 | 수동 | 30분 | 10분 자동 |
| 장애 복구 시간 (MTTR) | N/A | 2시간 | 30분 |
| 신규 기능 개발 시간 | N/A | -20% | -30% |

---

## 최종 권고사항

### CTO로서의 전략적 결정

1. **즉시 조치 (이번 주)**
   - JWT Secret 환경변수화는 Production 배포 전 필수
   - N+1 쿼리는 사용자 경험에 직접 영향

2. **단기 투자 (1개월)**
   - God Service 분해는 장기적 유지보수 비용 절감
   - 예외 처리 통일은 클라이언트 안정성 향상

3. **중기 투자 (3개월)**
   - CI/CD 파이프라인은 개발 속도 향상
   - 캐싱은 인프라 비용 절감

4. **기술 부채 관리**
   - 매 스프린트마다 20% 시간을 기술 부채 해결에 할당
   - 신규 기능보다 안정성 우선

### 예산 계획

- 인프라: Redis, 모니터링 도구 (월 $200-300)
- 도구: CI/CD, 코드 품질 분석 (월 $100-200)
- 교육: 온라인 강의, 컨퍼런스 (분기당 $500)

**총 예산**: 월 $300-500, 연간 $4,000-6,000

---

## 관련 문서

- [개선 작업 목록](./개선 작업 목록.md) - Phase별 상세 작업 및 체크리스트
- [엔티티 의존 관계](./ENTITY_DEPENDENCIES.md) - 엔티티 구조 및 의존성
- [테스트 진행 현황](./TESTING_PROGRESS.md) - Acceptance 테스트 현황

---

**작성일**: 2025-12-24
**팀 상황**: 3-5명 중규모 팀, 3-6개월 중장기 계획
**다음 리뷰**: 1주 후 (Sprint 1 시작 전)
